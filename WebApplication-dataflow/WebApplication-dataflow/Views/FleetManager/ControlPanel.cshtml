@{
    ViewBag.Title = "Fleet Manager Dashboard";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}
<h1>@ViewBag.Title</h1>
<hr />
<div ng-app="dataflowApp">
    <div ng-controller="AlertController">
        <div class="row">
            <div class="col-sm-3">
                <div class="well well-lg alert-item-red">
                    <h1>{{ maintenanceWarnings }}</h1>
                    <h4>Units should get a <a href="https://en.wikipedia.org/wiki/MOT_test" target="_blank">M.O.T.</a> test</h4>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="well well-lg alert-item-green">
                    <h1>{{ unitInformationWarnings }}</h1>
                    <h4>Units have a bad connection</h4>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="well well-lg alert-item-blue">
                    <h1>{{ unitDiskSpaceWarnings }}</h1>
                    <h4>Units have an almost full disk</h4>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="well well-lg alert-item-purple">
                    <h1>{{ averageConnectionTime }}</h1>
                    <h4>Average connection time (in seconds)</h4>
                </div>
            </div>
        </div>
    </div>
    <div ng-controller="MaintenanceController" style="margin-bottom: 32px;">
        <div class="row">
            <div class="col-sm-8">
                <div class="panel-group">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" href="#collapse1">Maintenance graphs</a>
                            </h4>
                        </div>
                        <div id="collapse1" class="panel-collapse collapse in">
                            <div class="panel-body">
                                <div id="maintenanceGraph" google-chart chart="chartObject" style="height:600px; width:100%;"></div>
                                <hr />
                                <form name="maintenanceForm">
                                    <h2>Interval</h2>
                                    <div class="form-group">
                                        <label for="begin">Begin:</label>
                                        <input name="beginTime" type="datetime-local" placeholder="yyyy-MM-ddTHH:mm:ss" ng-model="beginTime" class="form-control" id="begin" required>
                                        <div role="alert">
                                            <span class="error" ng-show="maintenanceForm.beginTime.$error.required">
                                                Required!
                                            </span>
                                            <span class="error" ng-show="maintenanceForm.beginTime.$error.datetimelocal">
                                                Not a valid date!
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="end">End:</label>
                                        <input name="endTime" type="datetime-local" placeholder="yyyy-MM-ddTHH:mm:ss" ng-model="endTime" class="form-control" id="end" required>
                                        <div role="alert">
                                            <span class="error" ng-show="maintenanceForm.endTime.$error.required">
                                                Required!
                                            </span>
                                            <span class="error" ng-show="maintenanceForm.endTime.$error.datetimelocal">
                                                Not a valid date!
                                            </span>
                                        </div>
                                    </div>
                                    <button type="button" ng-disabled="!hideLoadingMaintenance || maintenanceForm.beginTime.$error.datetimelocal || maintenanceForm.endTime.$error.datetimelocal" ng-click="loadMaitenance()" class="btn btn-default">Update</button>
                                    <button type="button" onclick="PdfGenerator.GenerateFromHtmlFancy('test', ['maintenanceGraph'])" class="btn btn-default">Generate pdf</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" href="#collapseMaintenance">Maintenance data</a>
                        </h4>
                    </div>
                    <div id="collapseMaintenance" class="panel-collapse collapse in">
                        <div ng-hide="hideLoadingMaintenance" class="progress">
                            <div class="progress-bar progress-bar-striped active" role="progressbar"
                                 aria-valuenow="{{ maintenanceItemsLoaded }}" aria-valuemin="0" aria-valuemax="{{ maintenance.length }}" style="width:{{ (maintenanceItemsLoaded / maintenance.length) * 100 }}%">
                                {{ (maintenanceItemsLoaded / maintenance.length) * 100 | number:0 }}%
                            </div>
                        </div>
                        <ul class="list-group">
                            <li class="list-group-item" ng-repeat="unit in maintenance" ng-if="unit.kilometersTravelled != -1">
                                {{ "Unit " + unit.unitId + " has driven " + unit.kilometersTravelled + " km"}}
                            </li>
                        </ul>
                        <img ng-hide="hideLoadingMaintenance" class="img-loader img-responsive" src="~/Content/Images/loading_dots.gif" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div ng-controller="IgnitionController">
        <div class="row">
            <div class="col-sm-8">
                <div class="panel-group">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" href="#collapse1">Ignition graph</a>
                            </h4>
                        </div>
                        <div id="collapse1" class="panel-collapse collapse in">
                            <div class="panel-body">
                                <div google-chart chart="chartObject" style="height:600px; width:100%;"></div>
                                <hr />
                                <h2>Interval</h2>
                                <div class="form-group">
                                    <label for="begin">Begin:</label>
                                    <input class="form-control" type="date" ng-model="startDate" /><br/>
                                    <label for="end">End:</label>
                                    <input class="form-control" type="date" ng-model="endDate" />
                                </div>

                                <button class="btn btn-default" type="button" ng-click="select()">Update</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@Scripts.Render("~/bundles/FleetManagerController")


